alerts:
- key: keycloak_token_user_realm_alert
  name: keycloak-token-user-realm-alert
  description: 'Keycloak (/token ''user'' realm): Total failure count exceeded (>
    5 in 5m)'
  data_source: core_app_insights
  query_template: |-
    requests
    | where appName == "%s"
    | where tostring(customDimensions.["kc.realmName"]) in ("user")
    | where not(operation_Name has "admin")
    | where name == "POST /realms/{realm}/protocol/{protocol}/token"
    | where success == false
  query_template_args:
  - core_app_insights
  trigger:
    operator: GreaterThanOrEqual
    threshold: 5
  email_subject: '[PARI][KEYCLOAK][HIGH] Keycloak /token ''user'' Realm Alert (Failures)'
