alerts:
- key: download_invoice_5xx_alert
  category_path:
  - download_invoice_file
  name: download-invoice-file-5xx-alert
  description: 'API Download Invoice File: 5xx error count exceeded (> 2 in 5m)'
  severity: 3
  query: |-
    AppRequests
    | where Name matches regex @"^GET /idpay-itn/merchant/portal/[^/]+/transactions/[^/]+/download$"
    | where ResultCode startswith "5"
  trigger:
    operator: GreaterThanOrEqual
    threshold: 2
  email_subject: '[PARI][ESE][LOW] Download Invoice File API Alert (5xx)'
- key: download_invoice_4xx_alert
  category_path:
  - download_invoice_file
  name: download-invoice-file-4xx-alert
  description: 'API Download Invoice File: 400/401/429 error count exceeded (> 1 in
    5m)'
  severity: 3
  query: |-
    AppRequests
    | where Name matches regex @"^GET /idpay-itn/merchant/portal/[^/]+/transactions/[^/]+/download$"
    | where ResultCode in ("400", "401", "429")
  trigger:
    operator: GreaterThanOrEqual
    threshold: 1
  email_subject: '[PARI][ESE][LOW] Download Invoice File API Alert (4xx)'
- key: retrieve_pos_5xx_alert
  category_path:
  - retrieve_a_point_of_sale
  name: retrieve-point-of-sale-5xx-alert
  description: 'API Retrieve a point of sale: 5xx error count exceeded (> 2 in 5m)'
  severity: 3
  query: |-
    AppRequests
    | where Name matches regex @"^GET /idpay-itn/merchant/portal/[^/]+/point-of-sales/[^/]+$"
    | where ResultCode startswith "5"
  trigger:
    operator: GreaterThanOrEqual
    threshold: 2
  email_subject: '[PARI][ESE][LOW] Retrieve a point of sale API Alert (5xx)'
- key: retrieve_pos_4xx_alert
  category_path:
  - retrieve_a_point_of_sale
  name: retrieve-point-of-sale-4xx-alert
  description: 'API Retrieve a point of sale: 401/404/429 error count exceeded (>
    3 in 5m)'
  severity: 3
  query: |-
    AppRequests
    | where Name matches regex @"^GET /idpay-itn/merchant/portal/[^/]+/point-of-sales/[^/]+$"
    | where ResultCode in ("401", "404", "429")
  trigger:
    operator: GreaterThanOrEqual
    threshold: 3
  email_subject: '[PARI][ESE][LOW] Retrieve a point of sale API Alert (4xx)'
