alerts:
- key: portal_consent_save_5m_rules
  category_path:
  - portal_consent
  name: portal-consent-save-5xx-401-429-alert
  description: Alert on POST /idpay-itn/register/consent errors (5xx > 5/5m; 401/429
    > 5/5m)
  query: |-
    AppRequests
    | where Name == "POST /idpay-itn/register/consent"
    | where ResultCode startswith "5" or ResultCode in ("401", "429")
  trigger:
    operator: GreaterThanOrEqual
    threshold: 5
  email_subject: '[PARI] Portal Consent – save API alert (5xx/401/429)'
- key: portal_consent_save_10m_rule
  category_path:
  - portal_consent
  name: portal-consent-save-400-alert
  description: Alert on POST /idpay-itn/register/consent errors (400 > 50/10m)
  frequency: 10
  time_window: 10
  query: |-
    AppRequests
    | where Name == "POST /idpay-itn/register/consent"
    | where ResultCode == "400"
  trigger:
    operator: GreaterThanOrEqual
    threshold: 50
  email_subject: '[PARI] Portal Consent – save API alert (400)'
- key: pari_portal_consent_get_5m_rules_alert
  category_path:
  - portal_consent
  name: pari-portal-consent-get-5xx-401-429-alert
  description: Alert on GET /idpay-itn/register/consent errors (5xx > 5/5m; 401/429
    > 5/5m)
  query: |-
    AppRequests
    | where Name == "GET /idpay-itn/register/consent"
    | where ResultCode startswith "5" or ResultCode in ("401", "429")
  trigger:
    operator: GreaterThanOrEqual
    threshold: 5
  email_subject: '[PARI] Portal Consent GET /consent alert (5xx/401/429)'
- key: pari_portal_consent_get_10m_rule_alert
  category_path:
  - portal_consent
  name: pari-portal-consent-get-400-alert
  description: Alert on GET /idpay-itn/register/consent errors (400 > 50/10m)
  frequency: 10
  time_window: 10
  query: |-
    AppRequests
    | where Name == "GET /idpay-itn/register/consent"
    | where ResultCode == "400"
  trigger:
    operator: GreaterThanOrEqual
    threshold: 50
  email_subject: '[PARI] Portal Consent GET /consent alert (400)'
- key: pari_product_files_upload_5m_rules_alert
  category_path:
  - product_files
  name: pari-product-files-upload-5xx-401-429-alert
  description: 'Product files upload API: 5xx/401/429 error threshold exceeded (>
    5/5m)'
  severity: 2
  query: |-
    AppRequests
    | where Name == "POST /idpay-itn/register/product-files"
    | where ResultCode startswith "5" or ResultCode in ("401", "429")
  trigger:
    operator: GreaterThanOrEqual
    threshold: 5
  email_subject: '[PARI] Product files – upload API alert (5xx/401/429)'
- key: pari_product_files_upload_10m_rule_alert
  category_path:
  - product_files
  name: pari-product-files-upload-400-alert
  description: 'Product files upload API: 400 error threshold exceeded (> 50/10m)'
  severity: 2
  frequency: 10
  time_window: 10
  query: |-
    AppRequests
    | where Name == "POST /idpay-itn/register/product-files"
    | where ResultCode == "400"
  trigger:
    operator: GreaterThanOrEqual
    threshold: 50
  email_subject: '[PARI] Product files – upload API alert (400)'
- key: pari_product_files_verify_alert
  category_path:
  - product_files
  name: pari-product-files-verify-alert
  description: 'Product files verify API: error threshold exceeded (5xx > 3/5m)'
  severity: 2
  query: |-
    AppRequests
    | where Name == "POST /idpay-itn/register/product-files/verify"
    | where ResultCode startswith "5"
  trigger:
    operator: GreaterThanOrEqual
    threshold: 3
  email_subject: '[PARI] Product files verify alert'
- key: pari_product_files_list_alert
  category_path:
  - product_files
  name: pari-product-files-list-alert
  description: 'Product files list API: 5xx error count exceeded (> 5 in 5m)'
  severity: 2
  query: |-
    AppRequests
    | where Name == "GET /idpay-itn/register/product-files"
    | where ResultCode startswith "5"
  trigger:
    operator: GreaterThanOrEqual
    threshold: 5
  email_subject: '[PARI] Product files – list API alert (5xx)'
- key: pari_products_update_status_alert
  category_path:
  - products
  name: pari-products-update-status-alert
  description: 'Products update status API: error threshold exceeded (5xx > 3/5m per
    endpoint)'
  severity: 3
  query: |-
    AppRequests
    | where Name in (
    "POST /idpay-itn/register/products/update-status/approved",
    "POST /idpay-itn/register/products/update-status/wait-approved",
    "POST /idpay-itn/register/products/update-status/supervised",
    "POST /idpay-itn/register/products/update-status/rejected",
    "POST /idpay-itn/register/products/update-status/restored"
    )
    | where ResultCode startswith "5"
  trigger:
    operator: GreaterThanOrEqual
    threshold: 3
  email_subject: '[PARI] Products update status alert'
- key: pari_get_products_5xx_alert
  category_path:
  - get_products
  name: pari-get-products-5xx-alert
  description: 'GET /products API: 5xx error count exceeded (> 5 in 5m)'
  severity: 0
  query: |-
    AppRequests
    | where Name == "GET /idpay-itn/register/products"
    | where ResultCode startswith "5"
  trigger:
    operator: GreaterThanOrEqual
    threshold: 5
  email_subject: '[PARI][CRITICAL] GET /products alert: High 5xx errors'
- key: pari_get_products_400_alert
  category_path:
  - get_products
  name: pari-get-products-400-alert
  description: 'GET /products API: 400 error count exceeded (> 50 in 10m)'
  severity: 0
  time_window: 10
  query: |-
    AppRequests
    | where Name == "GET /idpay-itn/register/products"
    | where ResultCode == "400"
  trigger:
    operator: GreaterThanOrEqual
    threshold: 50
  email_subject: '[PARI][CRITICAL] GET /products alert: High 400 errors'
- key: pari_get_products_availability_alert
  category_path:
  - get_products
  name: pari-get-products-availability-alert
  description: 'GET /products API: Availability dropped below 99% in the last 10 minutes'
  severity: 0
  time_window: 10
  query: |-
    AppRequests
    | where Name == "GET /idpay-itn/register/products"
    | summarize TotalRequests = count(), SuccessfulRequests = countif(Success == true)
    | extend Availability = (todouble(SuccessfulRequests) / todouble(TotalRequests)) * 100
    | where Availability < 99
  trigger:
    operator: GreaterThanOrEqual
    threshold: 1
  email_subject: '[PARI][CRITICAL] GET /products alert: Availability is below 99%'
- key: pari_user_permissions_5m_rules_alert
  category_path:
  - user_permissions
  name: pari-user-permissions-5m-rules-alert
  description: 'User Permissions API: 5xx > 5/5m; 401/429 > 5/5m'
  query: |-
    AppRequests
    | where Name == "GET /idpay-itn/register/permissions"
    | where ResultCode startswith "5" or ResultCode in ("401", "429")
  trigger:
    operator: GreaterThanOrEqual
    threshold: 5
  email_subject: '[PARI][HIGH] User Permissions alert (5xx or 401/429)'
- key: pari_user_permissions_10m_rule_alert
  category_path:
  - user_permissions
  name: pari-user-permissions-400-alert
  description: 'User Permissions API: 400 > 50/10m'
  time_window: 10
  query: |-
    AppRequests
    | where Name == "GET /idpay-itn/register/permissions"
    | where ResultCode == "400"
  trigger:
    operator: GreaterThanOrEqual
    threshold: 50
  email_subject: '[PARI][HIGH] User Permissions alert (400)'
- key: pari_error_report_download_alert
  category_path:
  - error_report_download
  name: pari-error-report-download-alert
  description: 'Error report download API: 5xx error count exceeded (> 5 in 5m)'
  severity: 3
  query: |-
    AppRequests
    | where Name == "GET /idpay-itn/register/product-files/*/report"
    | where ResultCode startswith "5"
  trigger:
    operator: GreaterThanOrEqual
    threshold: 5
  email_subject: '[PARI] Error report download API alert (5xx)'
- key: pari_batch_list_alert
  category_path:
  - batch_list
  name: pari-batch-list-alert
  description: 'Batch list API: 5xx error count exceeded (> 5 in 5m)'
  severity: 3
  query: |-
    AppRequests
    | where Name == "GET /idpay-itn/register/product-files/batch-list"
    | where ResultCode startswith "5"
  trigger:
    operator: GreaterThanOrEqual
    threshold: 5
  email_subject: '[PARI] Batch list API alert (5xx)'
- key: pari_institution_by_id_alert
  category_path:
  - institution_by_id
  name: pari-institution-by-id-alert
  description: 'Institution by ID API: 5xx error count exceeded (> 5 in 5m)'
  severity: 3
  query: |-
    AppRequests
    | where Name == "GET /idpay-itn/register/institutions/*"
    | where ResultCode startswith "5"
  trigger:
    operator: GreaterThanOrEqual
    threshold: 5
  email_subject: '[PARI] Institution by ID API alert (5xx)'
- key: pari_institutions_list_alert
  category_path:
  - institutions_list
  name: pari-institutions-list-alert
  description: 'Institutions list API: 5xx error count exceeded (> 5 in 5m)'
  severity: 3
  query: |-
    AppRequests
    | where Name == "GET /idpay-itn/register/institutions"
    | where ResultCode startswith "5"
  trigger:
    operator: GreaterThanOrEqual
    threshold: 5
  email_subject: '[PARI] Institutions list API alert (5xx)'
